<!-- _includes/head.html -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

{%- comment -%}
  TITRE + DESCRIPTION (fallbacks solides)
{%- endcomment -%}
<title>
  {%- if page.title -%}{{ page.title }} • {{ site.title }}{%- else -%}{{ site.title }}{%- endif -%}
</title>
<meta name="description" content="{{ page.description | default: site.description | strip_newlines }}" />

{%- comment -%}
  CANONICAL en absolu (évite les duplicats), sans index.html
{%- endcomment -%}
<link rel="canonical" href="{{ page.url | replace: 'index.html','' | absolute_url }}" />

{%- comment -%}
  ROBOTS : noindex pour les brouillons / pagination / balise front-matter
{%- endcomment -%}
{%- assign robots_meta = page.robots | default: site.robots -%}
{%- if robots_meta -%}<meta name="robots" content="{{ robots_meta }}"/>{%- endif -%}
{%- if page.noindex == true -%}<meta name="robots" content="noindex,follow"/>{%- endif -%}

{%- comment -%}
  THEME-COLOR (light/dark) pour PWA/Chrome
{%- endcomment -%}
<meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)" />
<meta name="theme-color" content="#eef1f6" media="(prefers-color-scheme: light)" />

{%- comment -%}
  OPEN GRAPH / TWITTER – URLs absolues + fallback image
{%- endcomment -%}
{%- assign og_title = page.title | default: site.title -%}
{%- assign og_desc  = page.description | default: site.description -%}
{%- assign og_image = page.image | default: site.og_image | default: '/assets/img/og-image.png' -%}
<meta property="og:type" content="website" />
<meta property="og:site_name" content="{{ site.title }}" />
<meta property="og:locale" content="fr_FR" />
<meta property="og:title" content="{{ og_title }} • {{ site.title }}" />
<meta property="og:description" content="{{ og_desc }}" />
<meta property="og:url" content="{{ page.url | replace:'index.html','' | absolute_url }}" />
<meta property="og:image" content="{{ og_image | absolute_url }}" />
{%- if page.last_modified_at -%}
<meta property="og:updated_time" content="{{ page.last_modified_at | date_to_xmlschema }}" />
{%- endif -%}

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ og_title }} • {{ site.title }}" />
<meta name="twitter:description" content="{{ og_desc }}" />
<meta name="twitter:image" content="{{ og_image | absolute_url }}" />
{%- if site.author.twitter -%}
<meta name="twitter:creator" content="@{{ site.author.twitter | replace:'@','' }}" />
{%- endif -%}

{%- comment -%}
  Langue + hreflang (auto-référence FR)
{%- endcomment -%}
<link rel="alternate" hreflang="fr" href="{{ page.url | replace:'index.html','' | absolute_url }}" />

{%- comment -%}
  CSS/JS – preload safe + feuille de style (évite FOUC), script en defer
{%- endcomment -%}
<link rel="preload" href="{{ '/assets/styles.css' | relative_url }}" as="style" />
<link rel="stylesheet" href="{{ '/assets/styles.css' | relative_url }}">
<script defer src="{{ '/assets/script.js' | relative_url }}"></script>

{%- comment -%}
  SITEMAP / ICONS (facultatif mais conseillé)
{%- endcomment -%}
<link rel="sitemap" type="application/xml" href="{{ '/sitemap.xml' | absolute_url }}">
<link rel="icon" href="{{ '/assets/favicon.ico' | relative_url }}">
<link rel="apple-touch-icon" href="{{ '/assets/apple-touch-icon.png' | relative_url }}">

{%- comment -%}
  JSON-LD : Person + ProfessionalService + WebSite/SearchAction
{%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Person",
      "name": "{{ site.author.name }}",
      "jobTitle": "{{ site.author.job_title | default: 'Consultant freelance ETL Talend & Power BI' }}",
      "url": "{{ site.author.url | default: site.url | default: site.github.url }}",
      {%- if site.author.email %}"email": "mailto:{{ site.author.email }}",{% endif -%}
      "sameAs": {{ site.author.sameAs | default: '[]' | jsonify }}
    },
    {
      "@type": "ProfessionalService",
      "name": "{{ site.title }}",
      "description": "{{ site.description }}",
      "url": "{{ site.url | default: site.github.url }}",
      "areaServed": "FR",
      "provider": { "@type": "Person", "name": "{{ site.author.name }}" }
    },
    {
      "@type": "WebSite",
      "name": "{{ site.title }}",
      "url": "{{ site.url | default: site.github.url }}",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "{{ site.url | default: site.github.url }}/search?q={query}",
        "query-input": "required name=query"
      }
    }
  ]
}
</script>

{%- comment -%}
  JSON-LD Article pour billets de blog (seulement si layout/post)
{%- endcomment -%}
{%- if page.layout == 'post' -%}
{%- assign article_image = page.image | default: site.og_image | default: '/assets/img/og-image.png' -%}
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Article",
  "headline":"{{ page.title }}",
  "description":"{{ page.description | default: site.description }}",
  "image":["{{ article_image | absolute_url }}"],
  "datePublished":"{{ page.date | date_to_xmlschema }}",
  {%- if page.last_modified_at -%}"dateModified":"{{ page.last_modified_at | date_to_xmlschema }}",{%- endif -%}
  "author":{"@type":"Person","name":"{{ site.author.name }}"},
  "publisher":{"@type":"Organization","name":"{{ site.title }}"}
}
</script>
{%- endif -%}
